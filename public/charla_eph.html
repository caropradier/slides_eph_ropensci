<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>rOpenSci</title>
    <meta charset="utf-8" />
    <meta name="author" content="Carolina Pradier" />
    <script src="libs/header-attrs-2.24/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: right, middle, title-slide

.title[
# rOpenSci
]
.subtitle[
## .lighty[<em>Paquete {eph}: Novedades e ideas para su uso</em>]
]
.author[
### Carolina Pradier
]
.date[
### .black[2023/12/15]
]

---






&lt;style type="text/css"&gt;
.remark-slide-content {
    font-size: 25px;
    padding: 1em 4em 4em 4em;
}
&lt;/style&gt;



En el marco del [rOpenSci Champions Program](https://ropensci.org/champions/), el paquete .bg-lila[eph] atravesó el proceso de [Software Peer Review](https://devguide.ropensci.org/softwarereviewintro.html)

![](icon_lettering_color.png)

---

class: left, bottom

# Bienvenides! 

--
El plan para hoy:

--

1.Les presentamos las .bg-lila[novedades] del paquete eph, cómo se mejora un paquete?



2..bg-lightgreen.white[Dos avances gracias a eph::get_microdata()] con *Valentín Alvarez (EIDAES-UNSAM / FCE-UBA)* 



3..bg-lightgreen.white[De la caja de herramientas en pendrive a la caja de herramientas en R: el paquete eph] con *Vladimiro Torres (EIDAES-UNSAM / FCE-UBA)* 



4..bg-lightgreen.white[Paquete eph y CEPED-DATA: dos proyectos, una misma filosofía] con *Guido Weksler (CONICET / CEPED-FCE-UBA)* 

---

.center[&lt;img src="logo.png" width="50%" /&gt;]

---

class: left, inverse, middle

# A. Estudiar y entender el paquete

--

**.black[1] .white[¿Qué hacen mis funciones?]** 



**.black[2] .white[Dependencias]**



**.black[3] .white[Experiencia del usuario]**

---

class: right, top

## ¿Qué hacen mis funciones?

.pull-left[.left[**[Las funciones de nuestro paquete](https://ropensci.github.io/eph/reference/index.html)** 

- Descarga y recodificación

*get_microdata(), organize_caes(), organize_cno(), organize_labels(), organize_panels(), get_total_urbano(), get_eahu(), get_poverty_lines()* 

- Procesamiento

*calculate_errors(), calculate_poverty(), calculate_tabulates(), map_agglomerates()*]]

--

Son fáciles de **.bg-lightgreen.white[leer]**? Fáciles de modificar? (¿Hay estructuras condicionales complejas?)

Los .lila[nombres] de mis funciones y sus argumentos son intuitivos? Son consistentes  (e.g. snake_case or camelCase)? Está bien la .purple[indentación]?

Son a prueba de usuarios? Los errores y advertencias contra **.red[inputs inválidos]** son fáciles de entender?
 

---


class: right, top

## Dependencias

El paquete tiene **.bg-lightgreen.white[demasiadas]** dependencias? (aprox 20 máx)

Qué *.yellow[función]* depende de cada *.yellow[paquete]*? 

Cuántas *.yellow[funciones]* de cada *.yellow[paquete]* usamos?

Podemos obtener el mismo resultado usando .white.bg-darkgreen[R base]?
    
--

&lt;/br&gt;

.pull-left[*Bonus:* **automatizar** los pasos repetitivos!]

---


class: right, top

## Experiencia del usuarie

Los mensajes de **.red[error]** y **.yellow[advertencia]** son claros y útiles? (les usuaries hablan *ingés*?)

**Documentación** y **sitio del paquete**




.pull-left[Escuchar a les usuaries: hay .bg-lila.black[issues]?
https://github.com/ropensci/eph/issues]

---

class: left, inverse, middle

# B. Mejorando el paquete

--

**.black[1] .white[Recursos útiles]**



**.black[2] .white[Git branches, checks y tests]**



**.black[3] .white[Mejorar las funciones]**


---

class: left, top

## Recursos útiles

- [Casi todo lo que alguien puede necesitar saber sobre los paquetes de R](https://r-pkgs.org/)

- [Los materiales](https://masalmon.eu/all/) de [Maëlle Salmon](https://github.com/maelle)

- Cómo mejorar nuestras [funciones](https://r4ds.had.co.nz/functions.html) y su [desempeño](https://adv-r.hadley.nz/perf-improve.html)

- Las [dependencias](https://r-pkgs.org/dependencies-mindset-background.html) de un paquete

---

class: right, top

## Git branches, checks y tests

Cómo asegurarnos de no romper nada?

1-Usando **.bg-lightgreen.white[git branches]** para cambios grandes

2-Corriendo **.yellow[tests]** (usando [testthat](https://testthat.r-lib.org/)) y **.red[checks]** frecuentemente

---

class: right, top

## Mejorar las funciones

Código .bg-yellow.black[elegante] (e.g.: early returns)

Asegurar compatibilidad con versiones anteriores: .bg-lightgreen.white["..."]

Mejorar **legibilidad**: considerar nombres, comentarios, estructuras condicionales, etc.

&lt;/br&gt;

.pull-left[.left[Dejamos dos videos que explican en más profundidad de qué se tratan estas mejoras ([inicial](https://www.youtube.com/watch?v=7oyiPBjLAWY&amp;t=2797s) y [avanzado](https://www.youtube.com/watch?v=2BXPLnLMTYo))]]

---

class: left, inverse, middle

# C. Resultados: Cuáles son las novedades del paquete .lila[_eph_]?

--

**.black[1] .white[Funciones nuevas]** 


**.black[2] .white[Código y dependencias]** 


**.black[3] .white[Documentación y mensajes de error]** 

---

class: right, top

## Funciones nuevas

Sumamos dos funciones nuevas: .white.bg-darkgreen[get_total_urbano()] y .white.bg-darkgreen[get_eahu()] para descargar las **Encuestas Anuales de Hogares Urbanos**.

---

class: right, top

## Código y dependencias

Reestructuramos las .white.bg-darkgreen[funciones] para un código más limpio, eficiente y legible. El código ahora sigue las pautas de estilo de tidyverse.

Modificamos la función .white.bg-darkgreen[get_microdata()] para evitar conflictos de parámetros entre trimestre y onda.

Redujimos las dependencias, recurriendo más a .white.bg-darkgreen[R base].

--

.pull-left[.bg-lila[Un ejemplo]: glue vs sprintf]

&lt;/br&gt;


```r
link = glue::glue("https://www.indec.gob.ar/ftp/cuadros
                 /menusuperior/eph/EPH_usu_{trimester}_Trim_{year}_txt.zip")
```


```r
link= sprintf('https://www.indec.gob.ar/ftp/cuadros
              /menusuperior/eph/EPH_usu_%s_Trim_%s_txt.zip',
              trimester,year)
```

---

class: right, top

## Documentación y mensajes de error

Mejoramos la documentación y el [sitio web del paquete](https://ropensci.github.io/eph/). Por otro lado, las mejoras (y traducciones) en los mensajes de **.red[error]** y **.yellow[advertencia]** hacen que trabajar con el paquete sea más intuitivo. Les usuaries no deberían necesitar **conocimiento experto** para trabajar con nuestros datasets.

--

Al correr este código (la variable departamentos no existe):


```r
calculate_tabulates(x = "departamentos", add.percentage = "col")
```

El mensaje de error era este: 


```r
Error in model.frame.default(formula = ~x_vec, data = base) :
  invalid type (NULL) for variable 'x_vec'
```

Y ahora:


```r
Error in `calculate_tabulates()`:
! La variable x no pertence a la base de datos
ℹ Puede usar names() para extraer los nombres de las variables.
```

---

class: center, inverse, middle

# Gracias!
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
